# E2E 테스트 시나리오

음성 주문 시스템의 E2E 테스트 시나리오 20개입니다.
단순한 것부터 복잡한 것까지 다양한 상황을 포함합니다.

## 테스트 표기법

| 항목 | 설명 |
|------|------|
| **음성 입력** | 사용자가 말하는 내용 (STT 결과) |
| **예상 Intent** | Gemini가 반환해야 하는 Intent 타입 |
| **예상 결과** | UI 변화 및 TTS 응답 |
| **주문 상태** | 테스트 전 주문 목록 상태 |

---

## 1. 단순 추가 - 온도 명시 (HOT)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "따뜻한 아메리카노 주세요" |
| **예상 Intent** | `ADD_ITEM` |
| **예상 결과** | - 주문 목록에 "HOT 아메리카노 1잔" 추가<br>- TTS: "아메리카노 1잔 추가했습니다." |

---

## 2. 단순 추가 - 온도 명시 (ICE)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "아이스 카페라떼 하나요" |
| **예상 Intent** | `ADD_ITEM` |
| **예상 결과** | - 주문 목록에 "ICE 카페라떼 1잔" 추가<br>- TTS: "카페라떼 1잔 추가했습니다." |

---

## 3. 단순 추가 - 온도 미명시 (명확화 필요)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "바닐라라떼 주세요" |
| **예상 Intent** | `ADD_ITEM` (temperature: null) 또는 `ASK_CLARIFICATION` |
| **예상 결과** | - 온도 선택 모달 표시<br>- TTS: "바닐라라떼 따뜻하게 드릴까요, 차갑게 드릴까요?" |

---

## 4. 단순 추가 - 단일 온도 메뉴 (ICE only)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "콜드브루 주세요" |
| **예상 Intent** | `ADD_ITEM` (temperature: ICE 자동 선택) |
| **예상 결과** | - 주문 목록에 "ICE 콜드브루 1잔" 추가<br>- 온도 질문 없이 바로 추가<br>- TTS: "콜드브루 1잔 추가했습니다." |

---

## 5. 단순 추가 - 단일 온도 메뉴 (HOT only)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "에스프레소 한 잔이요" |
| **예상 Intent** | `ADD_ITEM` (temperature: HOT 자동 선택) |
| **예상 결과** | - 주문 목록에 "HOT 에스프레소 1잔" 추가<br>- 온도 질문 없이 바로 추가<br>- TTS: "에스프레소 1잔 추가했습니다." |

---

## 6. 수량 지정 추가 - 한글 수량

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "아이스 아메리카노 세 잔 주세요" |
| **예상 Intent** | `ADD_ITEM` (quantity: 3) |
| **예상 결과** | - 주문 목록에 "ICE 아메리카노 3잔" 추가<br>- TTS: "아메리카노 3잔 추가했습니다." |

---

## 7. 복수 메뉴 추가 - 온도 모두 명시

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "따뜻한 카페라떼 두 잔하고 아이스 아메리카노 세 잔이요" |
| **예상 Intent** | `ADD_ITEM` (items: 2개) |
| **예상 결과** | - 주문 목록에 "HOT 카페라떼 2잔", "ICE 아메리카노 3잔" 추가<br>- TTS: "카페라떼 2잔 아메리카노 3잔 추가했습니다." |

---

## 8. 복수 메뉴 추가 - 일부 온도 미명시

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "아이스 아메리카노 두 잔이랑 바닐라라떼 세 잔 주세요" |
| **예상 Intent** | `ADD_ITEM` (아메리카노 ICE, 바닐라라떼 null) |
| **예상 결과** | - 아메리카노 2잔 바로 추가<br>- 바닐라라떼 온도 선택 모달 표시<br>- TTS: "바닐라라떼 따뜻하게 드릴까요, 차갑게 드릴까요?" |

---

## 9. 디저트 추가 (온도 없는 메뉴)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "크루아상 두 개 주세요" |
| **예상 Intent** | `ADD_ITEM` (temperature: null, 명확화 불필요) |
| **예상 결과** | - 주문 목록에 "크루아상 2개" 추가<br>- 온도 질문 없음<br>- TTS: "크루아상 2개 추가했습니다." |

---

## 10. 메뉴 삭제 - 단일 항목

| 항목 | 내용 |
|------|------|
| **주문 상태** | ICE 아메리카노 2잔, HOT 카페라떼 1잔 |
| **음성 입력** | "아메리카노 빼주세요" |
| **예상 Intent** | `REMOVE_ITEM` |
| **예상 결과** | - 주문 목록에서 아메리카노 삭제<br>- TTS: "아메리카노를 삭제했습니다." |

---

## 11. 수량 변경

| 항목 | 내용 |
|------|------|
| **주문 상태** | ICE 아메리카노 2잔 |
| **음성 입력** | "아메리카노 다섯 잔으로 바꿔주세요" |
| **예상 Intent** | `CHANGE_QUANTITY` (quantity: 5) |
| **예상 결과** | - 주문 목록의 아메리카노 수량이 5잔으로 변경<br>- TTS: "아메리카노 수량을 5잔으로 변경했습니다." |

---

## 12. 온도 변경

| 항목 | 내용 |
|------|------|
| **주문 상태** | HOT 카페라떼 1잔 |
| **음성 입력** | "카페라떼 아이스로 바꿔주세요" |
| **예상 Intent** | `CHANGE_TEMPERATURE` (temperature: ICE) |
| **예상 결과** | - 주문 목록의 카페라떼 온도가 ICE로 변경<br>- TTS: "카페라떼 온도를 아이스로 변경했습니다." |

---

## 13. 복합 명령 - 수량 여러 개 동시 변경

| 항목 | 내용 |
|------|------|
| **주문 상태** | ICE 아메리카노 1잔, HOT 카페라떼 1잔 |
| **음성 입력** | "아메리카노 두 잔으로, 카페라떼 세 잔으로 바꿔줘" |
| **예상 Intent** | `MULTI_ACTION` (두 아이템 모두 CHANGE_QUANTITY) |
| **예상 결과** | - 아메리카노 2잔, 카페라떼 3잔으로 변경<br>- TTS: "아메리카노 수량을 2잔으로 변경했습니다. 카페라떼 수량을 3잔으로 변경했습니다." |

---

## 14. 복합 명령 - 추가 + 삭제

| 항목 | 내용 |
|------|------|
| **주문 상태** | ICE 아메리카노 2잔 |
| **음성 입력** | "아이스 카페라떼 추가하고 아메리카노 빼줘" |
| **예상 Intent** | `MULTI_ACTION` (ADD + REMOVE) |
| **예상 결과** | - 아메리카노 삭제, ICE 카페라떼 1잔 추가<br>- TTS: "아메리카노를 삭제했습니다. 카페라떼 1잔 추가했습니다." |

---

## 15. 복합 명령 - 온도 변경 + 추가

| 항목 | 내용 |
|------|------|
| **주문 상태** | HOT 아메리카노 1잔 |
| **음성 입력** | "아메리카노 아이스로 바꾸고 따뜻한 카페라떼 두 잔 추가해줘" |
| **예상 Intent** | `MULTI_ACTION` (CHANGE_TEMPERATURE + ADD) |
| **예상 결과** | - 아메리카노 ICE로 변경, HOT 카페라떼 2잔 추가<br>- TTS: "아메리카노 온도를 아이스로 변경했습니다. 카페라떼 2잔 추가했습니다." |

---

## 16. 전체 주문 취소

| 항목 | 내용 |
|------|------|
| **주문 상태** | ICE 아메리카노 2잔, HOT 카페라떼 1잔, 크루아상 1개 |
| **음성 입력** | "전부 취소해주세요" |
| **예상 Intent** | `CLEAR_ORDER` |
| **예상 결과** | - 주문 목록 전체 삭제<br>- TTS: "주문을 모두 취소했습니다." |

---

## 17. 주문 확정

| 항목 | 내용 |
|------|------|
| **주문 상태** | ICE 아메리카노 2잔, HOT 카페라떼 1잔 |
| **음성 입력** | "결제할게요" |
| **예상 Intent** | `CONFIRM_ORDER` |
| **예상 결과** | - 주문 확인 모달 표시 또는 결제 진행<br>- TTS: "주문을 확정합니다." |

---

## 18. 음성 오인식 - 발음 유사 메뉴

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "아이스 롯데 두 잔이요" (카페라떼 의도) |
| **예상 Intent** | `ADD_ITEM` (menuId: cafe-latte) |
| **예상 결과** | - "롯데" → "카페라떼"로 매칭<br>- 주문 목록에 "ICE 카페라떼 2잔" 추가<br>- TTS: "카페라떼 2잔 추가했습니다." |

---

## 19. 음성 오인식 - 부분 매칭

| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "따뜻한 아매 하나요" (아메리카노 의도) |
| **예상 Intent** | `ADD_ITEM` (menuId: americano) |
| **예상 결과** | - "아매" → "아메리카노"로 매칭<br>- 주문 목록에 "HOT 아메리카노 1잔" 추가<br>- TTS: "아메리카노 1잔 추가했습니다." |

---

## 20. 무관한 발화 (UNKNOWN)

| 항목 | 내용 |
|------|------|
| **주문 상태** | 무관 |
| **음성 입력** | "오늘 날씨 어때요?" |
| **예상 Intent** | `UNKNOWN` |
| **예상 결과** | - 주문 목록 변경 없음<br>- TTS: "저는 주문과 관련된 대화만 가능합니다. 주문과 관련된 말씀 부탁드립니다." |

---

## 테스트 체크리스트

### 기본 기능
- [ ] 1. 단순 추가 - HOT 명시
- [ ] 2. 단순 추가 - ICE 명시
- [ ] 3. 단순 추가 - 온도 미명시 (명확화)
- [ ] 4. 단일 온도 메뉴 (ICE only)
- [ ] 5. 단일 온도 메뉴 (HOT only)
- [ ] 6. 수량 지정 추가
- [ ] 7. 복수 메뉴 추가 (온도 모두 명시)
- [ ] 8. 복수 메뉴 추가 (일부 온도 미명시)
- [ ] 9. 디저트 추가

### 수정/삭제
- [ ] 10. 메뉴 삭제
- [ ] 11. 수량 변경
- [ ] 12. 온도 변경

### 복합 명령
- [ ] 13. 복합 - 수량 여러 개 동시 변경
- [ ] 14. 복합 - 추가 + 삭제
- [ ] 15. 복합 - 온도 변경 + 추가

### 주문 흐름
- [ ] 16. 전체 취소
- [ ] 17. 주문 확정

### 예외 처리
- [ ] 18. 음성 오인식 - 발음 유사
- [ ] 19. 음성 오인식 - 부분 매칭
- [ ] 20. 무관한 발화

---

## 추가 엣지 케이스 (선택)

### 엣지 케이스 A: 존재하지 않는 메뉴
| 항목 | 내용 |
|------|------|
| **음성 입력** | "피자 주세요" |
| **예상 Intent** | `UNKNOWN` |
| **예상 결과** | TTS: "죄송합니다. 해당 메뉴를 찾을 수 없습니다." |

### 엣지 케이스 B: 삭제할 메뉴 없음
| 항목 | 내용 |
|------|------|
| **주문 상태** | HOT 카페라떼 1잔 |
| **음성 입력** | "아메리카노 빼주세요" |
| **예상 Intent** | `REMOVE_ITEM` |
| **예상 결과** | TTS: "삭제할 메뉴를 찾을 수 없습니다." |

### 엣지 케이스 C: 빈 주문에서 확정
| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "주문할게요" |
| **예상 Intent** | `CONFIRM_ORDER` |
| **예상 결과** | TTS: "주문할 메뉴가 없습니다. 먼저 메뉴를 선택해주세요." |

### 엣지 케이스 D: 연속 온도 명확화
| 항목 | 내용 |
|------|------|
| **주문 상태** | 빈 주문 |
| **음성 입력** | "카페라떼 두 잔, 바닐라라떼 세 잔 주세요" |
| **예상 흐름** | 1. 카페라떼 온도 질문 → "따뜻하게요"<br>2. 바닐라라떼 온도 질문 → "아이스로요"<br>3. TTS: "따뜻한 카페라떼 2잔, 아이스 바닐라라떼 3잔 추가했습니다." |

### 엣지 케이스 E: 동일 메뉴 다른 온도
| 항목 | 내용 |
|------|------|
| **음성 입력** | "따뜻한 아메리카노 두 잔이랑 아이스 아메리카노 한 잔 주세요" |
| **예상 결과** | - HOT 아메리카노 2잔, ICE 아메리카노 1잔 각각 추가<br>- 총 3잔이 아닌 별도 항목으로 관리 |

---

## 시스템 레벨 E2E 시나리오 (10개)

디버그 패널을 통해 실행하는 시스템 전체 플로우 테스트입니다.

### 시스템 TC-001: 기본 주문 플로우 (Happy Path)

| 항목 | 내용 |
|------|------|
| **난이도** | 쉬움 |
| **목적** | 전체 주문 플로우가 정상 작동하는지 확인 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "아이스 아메리카노 한 잔 주세요"
3. [텍스트] "결제해줘"
```

**검증 포인트:**
- [ ] 얼굴 감지 → 세션 시작 → 인사 TTS
- [ ] 메뉴/온도/수량 정확 매핑
- [ ] 결제 완료 → 주문번호 발급
- [ ] 주문 대기열에 추가

---

### 시스템 TC-002: 누락 정보 보완 (Multi-turn)

| 항목 | 내용 |
|------|------|
| **난이도** | 중간 |
| **목적** | 온도 누락 시 명확화 질문 확인 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "카페라떼 주세요"
3. [대기] 시스템 질문 확인
4. [텍스트] "따뜻한 거"
```

**검증 포인트:**
- [ ] 온도 누락 감지
- [ ] 명확화 질문 TTS
- [ ] 문맥 유지하며 주문 완성

---

### 시스템 TC-003: 복합 주문 (Multiple Items)

| 항목 | 내용 |
|------|------|
| **난이도** | 어려움 |
| **목적** | 한 문장에 여러 메뉴 분리 인식 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "따뜻한 아메리카노 두 잔이랑 아이스 모카 한 잔 줘"
```

**검증 포인트:**
- [ ] 조사('랑')로 메뉴 분리
- [ ] 각 메뉴별 수량/온도 정확 매핑
- [ ] 장바구니에 2개 항목 추가

---

### 시스템 TC-004: 주문 정정 (Correction)

| 항목 | 내용 |
|------|------|
| **난이도** | 중간 |
| **목적** | 말 도중 의사 변경 처리 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "아이스 아메리카노... 아니 라떼로 줘"
```

**검증 포인트:**
- [ ] "아니" 키워드 인식
- [ ] 아메리카노 무시, 라떼만 추가
- [ ] 온도(아이스) 속성 유지

---

### 시스템 TC-005: 수량 변경 (Context Update)

| 항목 | 내용 |
|------|------|
| **난이도** | 중간 |
| **목적** | 기존 주문 수량 수정 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "핫초코 한 잔"
3. [대기] 1초
4. [텍스트] "아, 두 잔으로 바꿔줘"
```

**검증 포인트:**
- [ ] 새 주문 아닌 수정으로 인식
- [ ] 수량 1→2 업데이트
- [ ] TTS 수량 변경 확인

---

### 시스템 TC-006: 주문 취소 및 초기화

| 항목 | 내용 |
|------|------|
| **난이도** | 쉬움 |
| **목적** | 명시적 취소 요청 처리 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "아이스 아메리카노 한 잔"
3. [텍스트] "주문 다 취소할래"
```

**검증 포인트:**
- [ ] 장바구니 완전 클리어
- [ ] TTS 취소 안내
- [ ] 세션 상태 초기화

---

### 시스템 TC-007: 세션 타임아웃 (Auto Reset)

| 항목 | 내용 |
|------|------|
| **난이도** | 쉬움 |
| **목적** | 자동 세션 종료 확인 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [빨리감기] 15초
3. [확인] 마이크 비활성화 상태
4. [빨리감기] 30초 (총 45초)
5. [확인] 세션 종료
```

**검증 포인트:**
- [ ] 15초: 마이크 비활성화 UI
- [ ] 35초: 세션 종료 임박 경고
- [ ] 45초: 스플래시 화면 복귀
- [ ] 장바구니 클리어

---

### 시스템 TC-008: 화면 터치로 세션 연장

| 항목 | 내용 |
|------|------|
| **난이도** | 중간 |
| **목적** | 마이크 비활성화 후 터치로 재활성화 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [빨리감기] 20초 (마이크 비활성화)
3. [터치] 화면 터치 시뮬레이션
4. [확인] 타이머 리셋
5. [텍스트] "아메리카노 한 잔"
```

**검증 포인트:**
- [ ] 터치 시 타이머 45초 리셋
- [ ] 마이크 재활성화 (15초 윈도우)
- [ ] 주문 정상 입력

---

### 시스템 TC-009: 암시적 표현 처리

| 항목 | 내용 |
|------|------|
| **난이도** | 어려움 |
| **목적** | 구체적 메뉴명 없이 주문 처리 |

**입력 시퀀스:**
```
1. [얼굴 감지] 세션 시작
2. [텍스트] "시원한 커피 아무거나 줘"
```

**검증 포인트:**
- [ ] '시원한' → ICE 매핑
- [ ] '커피' → 커피 카테고리 매핑
- [ ] 인기 메뉴 추천 또는 질문

---

### 시스템 TC-010: 연속 주문 (다중 사용자)

| 항목 | 내용 |
|------|------|
| **난이도** | 중간 |
| **목적** | 주문 완료 후 다음 세션 정상 시작 |

**입력 시퀀스:**
```
[사용자 A]
1. [얼굴 감지] 세션 시작
2. [텍스트] "아메리카노 한 잔"
3. [텍스트] "결제"
4. [확인] 주문번호 발급

[2초 후]

[사용자 B]
5. [얼굴 감지] 새 세션 시작
6. [텍스트] "라떼 한 잔"
```

**검증 포인트:**
- [ ] 사용자 A 주문 완료 후 대기열 추가
- [ ] 사용자 B 빈 장바구니로 시작
- [ ] 이전 주문 정보 미잔류
- [ ] 즉시 새 세션 시작

---

## 디버그 패널 인터페이스

```typescript
interface DebugPanelActions {
  // 세션 제어
  simulateFaceDetection(): void;   // 얼굴 감지 시뮬레이션
  simulateTouch(): void;           // 화면 터치 시뮬레이션
  endSession(): void;              // 세션 강제 종료

  // 음성 입력 시뮬레이션
  sendTextInput(text: string): void;

  // 타이머 제어
  fastForward(seconds: number): void;  // 시간 빨리감기
  resetTimer(): void;                   // 타이머 리셋

  // 상태 조회
  getSessionState(): {
    isActive: boolean;
    timeLeft: number;
    isMicActive: boolean;
  };
  getOrderState(): {
    items: OrderItem[];
    total: number;
  };
  getQueueState(): {
    preparing: QueueItem[];
    ready: QueueItem[];
  };

  // 시나리오 실행
  runScenario(scenarioId: string): Promise<TestResult>;
  runAllScenarios(): Promise<TestResult[]>;
}
```

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2025-01-28 | 1.1 | 시스템 레벨 E2E 시나리오 10개 추가 |
| 2025-01-27 | 1.0 | 음성 처리 시나리오 20개 작성 |
